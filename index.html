<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Настройки News Bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #ffffff);
            --text: var(--tg-theme-text-color, #222222);
            --hint: var(--tg-theme-hint-color, #999999);
            --button: var(--tg-theme-button-color, #248bed);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f7);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            user-select: none;
        }

        .section {
            background-color: var(--secondary-bg);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 14px;
        }

        .value-display {
            float: right;
            color: var(--button);
            font-weight: bold;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--hint);
            background-color: var(--bg);
            color: var(--text);
            box-sizing: border-box;
            font-size: 16px;
        }

        input[type="range"] {
            width: 100%;
            margin-top: 10px;
            accent-color: var(--button);
        }

        .hint-text {
            font-size: 12px;
            color: var(--hint);
            margin-top: 8px;
        }

        button {
            background-color: var(--button);
            color: var(--button-text);
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body>

    <div class="section">
        <label>ID ЧАТА (Куда слать новости)</label>
        <input type="text" id="chat_id" placeholder="-1001234567890">
        <div class="hint-text">Введите ID группы или канала, куда бот будет постить ленту.</div>
    </div>

    <div class="section">
        <label>ЧАСТОТА ПРОВЕРКИ: <span id="freq_val" class="value-display">30</span> мин</label>
        <input type="range" id="freq" min="1" max="120" value="30" oninput="updateVal('freq')">
    </div>

    <div class="section">
        <label>ПОСТОВ ЗА РАЗ: <span id="count_val" class="value-display">3</span></label>
        <input type="range" id="count" min="1" max="15" value="3" oninput="updateVal('count')">
    </div>

    <div class="section">
        <label>АКТУАЛЬНОСТЬ: <span id="fresh_val" class="value-display">24</span> ч</label>
        <input type="range" id="fresh" min="1" max="72" value="24" oninput="updateVal('fresh')">
    </div>

    <button onclick="sendDataToBot()">ПРИМЕНИТЬ НА ПК</button>

    <script>
        // Инициализация Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand(); // Развернуть на весь экран

        // 1. Получаем данные из URL (которые прислал bot.py)
        const params = new URLSearchParams(window.location.search);
        
        if (params.has('chat_id')) {
            document.getElementById('chat_id').value = params.get('chat_id');
        }
        if (params.has('freq')) {
            const f = params.get('freq');
            document.getElementById('freq').value = f;
            document.getElementById('freq_val').innerText = f;
        }
        if (params.has('count')) {
            const c = params.get('count');
            document.getElementById('count').value = c;
            document.getElementById('count_val').innerText = c;
        }
        if (params.has('fresh')) {
            const s = params.get('fresh');
            document.getElementById('fresh').value = s;
            document.getElementById('fresh_val').innerText = s;
        }

        // 2. Функция обновления цифр при движении ползунка
        function updateVal(id) {
            const val = document.getElementById(id).value;
            document.getElementById(id + '_val').innerText = val;
        }

        // 3. Главная функция: отправка данных боту
        function sendDataToBot() {
            const data = {
                chat_id: document.getElementById('chat_id').value,
                freq: document.getElementById('freq').value,
                count: document.getElementById('count').value,
                fresh: document.getElementById('fresh').value
            };

            // Превращаем объект в строку и отправляем боту
            tg.sendData(JSON.stringify(data));
            
            // Закрываем WebApp
            tg.close();
        }
    </script>
</body>
</html>
